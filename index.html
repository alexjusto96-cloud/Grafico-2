<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  <title>Gráfico rendimiento</title>

  <script src="https://www.gstatic.com/charts/loader.js"></script>

  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      text-align: center; /* Centra título y subtítulo */
    }

    #chart {
      width: 100%;
      height: 90vh;
      margin-top: 10px;
    }

    h1, h2 {
      margin: 0;
      padding: 5px 0;
    }
  </style>
</head>

<body>

  <h1 id="titulo">Evolución del rendimiento</h1>
  <h2 id="subtitulo"></h2>

  <div id="chart"></div>

  <script>
    google.charts.load('current', { packages: ['corechart'] });
    google.charts.setOnLoadCallback(init);

    async function init() {

      const url = "https://script.google.com/macros/s/AKfycbxMfiseKw7Fh810OIbEPnGrNZa-ZviQ7XYUifrdrk7lxfHdjODFPRzw0QmLehMKnicI/exec";

      const r = await fetch(url);
      const json = await r.json();

      const header = json.header;
      const data   = json.data;

      // --- NUEVO: subtítulo desde C22 ---
      document.getElementById("subtitulo").innerText = json.subtitulo || "";

      if (!data || data.length === 0) {
        document.getElementById('chart').innerText = "Sin datos.";
        return;
      }

      const dt = new google.visualization.DataTable();
      dt.addColumn('date', header[0]);
      dt.addColumn('number', header[1]);

      const rows = data.map(row => {
        const p = row[0].split("/");
        return [new Date(p[0], p[1] - 1, p[2]), Number(row[1])];
      });

      dt.addRows(rows);

      const vals = rows.map(r => r[1]);
      const min = Math.min(...vals);
      const max = Math.max(...vals);
      const margin = (max - min) * 0.1 || 1;

      const options = {
        title: "",     // Título lo ponemos fuera con <h1>
        legend: { position: "none" },
        hAxis: {
          title: header[0],
          format: 'yyyy/MM/dd'
        },

        // --- NUEVO: nombre eje Y = C23 ---
        vAxis: {
          title: json.ejeY || header[1],
          viewWindow: { min: min - margin, max: max + margin }
        },

        trendlines: {
          0: { type: 'linear', visibleInLegend: true }
        }
      };

      new google.visualization.ScatterChart(
        document.getElementById("chart")
      ).draw(dt, options);
    }
  </script>

</body>
</html>


